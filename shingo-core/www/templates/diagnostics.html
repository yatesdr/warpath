{{define "content"}}
<h1 class="mb-2">Diagnostics</h1>

<div class="grid grid-3 mb-2">
  <div class="card stat">
    <div class="value">
      <span class="health {{if .FleetOK}}health-ok{{else}}health-fail{{end}}"></span>
      {{if .FleetOK}}Connected{{else}}Disconnected{{end}}
    </div>
    <div class="label">Fleet ({{.FleetName}})</div>
  </div>
  <div class="card stat">
    <div class="value">
      <span class="health {{if .MessagingOK}}health-ok{{else}}health-fail{{end}}"></span>
      {{if .MessagingOK}}Connected{{else}}Disconnected{{end}}
    </div>
    <div class="label">Messaging</div>
  </div>
  <div class="card stat">
    <div class="value">{{.PollerActive}}</div>
    <div class="label">Polling Orders</div>
  </div>
</div>

<div class="card">
  <div class="flex flex-between mb-1">
    <h3>Audit Log</h3>
    <span class="text-muted">SSE clients: {{.SSEClients}}</span>
  </div>
  {{if .AuditLog}}
  <table>
    <thead>
      <tr>
        <th>Time</th>
        <th>Entity</th>
        <th>ID</th>
        <th>Action</th>
        <th>Detail</th>
        <th>Actor</th>
      </tr>
    </thead>
    <tbody>
      {{range .AuditLog}}
      <tr>
        <td>{{formatTime .CreatedAt}}</td>
        <td>{{.EntityType}}</td>
        <td>{{.EntityID}}</td>
        <td>{{.Action}}</td>
        <td>{{.NewValue}}</td>
        <td>{{.Actor}}</td>
      </tr>
      {{end}}
    </tbody>
  </table>
  {{else}}
  <p class="text-muted">No audit entries.</p>
  {{end}}
</div>
{{end}}
